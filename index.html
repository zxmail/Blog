<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的博客</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://gravatar.azure.cc/static/lib/fontawesome5pro/css/all.min.css?v=1.5.8">
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .content-area a { color: #3b82f6; text-decoration: underline; }
        .dark .content-area a { color: #60a5fa; }
        .content-area h1, .content-area h2, .content-area h3 { font-weight: 600; margin-top: 1.5em; margin-bottom: 0.5em; border: none; padding: 0;}
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        #back-to-top { position: fixed; bottom: 2rem; right: 2rem; display: none; }
        .group .dropdown-menu { display: none; }
        .group:hover .dropdown-menu { display: block; }
        .group .sub-menu { display: none; }
        .group-hover\:block .sub-menu { display: block; }
        .dark .dropdown-menu, .dark .sub-menu { background-color: #1f2937; border-color: #4b5563; }
        .rounded-lg { border-radius: 0.3rem !important; }
        .rounded-md { border-radius: 0.1rem !important; }
        .py-8 { padding-top: 1.5rem !important; padding-bottom: 1.8rem !important; }
        .border-gray-200 { border-color: rgb(245 245 245 / 1) !important; }
        .dark .dark\:divide-gray-700 > :not([hidden]) ~ :not([hidden]),
        .dark .dark\:border-gray-700 { border-color: rgb(31 41 55 / 1) !important; }
        body {
            background-color: #f5f5f5;
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }
        .dark body { background-color: #111827; }
        .carousel-slide { transition-property: opacity, transform; }
    </style>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
</head>
<body class="text-gray-800 dark:text-gray-200">

    <div id="app" class="flex flex-col min-h-screen"></div>
    
    <button id="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="bg-blue-500 hover:bg-blue-600 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center">
      <i class="fal fa-arrow-up"></i>
    </button>

    <script>
        const App = {
            config: {
                workerUrl: 'https://blog.xy193.workers.dev' // 请替换为您自己的Worker URL
            },
            state: {
                posts: [], navItems: [], tags: [], categories: {}, recentPosts: [],
                friendlyLinks: [], recentComments: [], siteStats: null, comments: {}, 
                theme: localStorage.getItem('theme') || 'light', carouselInterval: null, carouselSettings: null
            },
            init() { /* ... */ },
            applyTheme() { /* ... */ },
            toggleTheme() { /* ... */ },
            
            initCarousel() {
                const container = document.getElementById('carousel-container');
                if (!container) return;
                if (this.state.carouselInterval) clearInterval(this.state.carouselInterval);

                const settings = this.state.carouselSettings || { transition: 'fade', speed: 700, delay: 5000 };
                
                let currentSlide = 0;
                const slides = container.querySelectorAll('.carousel-slide');
                const dots = container.querySelectorAll('.carousel-dot');
                const totalSlides = slides.length;
                if (totalSlides <= 1) return;

                // Apply transition speed to all slides
                slides.forEach(slide => {
                    slide.style.transitionDuration = `${settings.speed}ms`;
                });

                const showSlide = (newIndex, direction = 1) => {
                    const oldIndex = currentSlide;
                    if (newIndex === oldIndex) return;
                    
                    slides.forEach((slide, i) => slide.style.zIndex = (i === oldIndex) ? '10' : '5');
                    
                    const newSlide = slides[newIndex];
                    const oldSlide = slides[oldIndex];
                    newSlide.style.zIndex = '20';

                    dots.forEach((d, i) => { d.classList.toggle('bg-white', i === newIndex); d.classList.toggle('bg-white/50', i !== newIndex);});

                    if (settings.transition === 'fade') {
                        newSlide.style.opacity = '0';
                        requestAnimationFrame(() => {
                            newSlide.style.opacity = '1';
                            oldSlide.style.opacity = '0';
                        });
                    } else if (settings.transition === 'slide-x') {
                        newSlide.style.transform = `translateX(${100 * direction}%)`;
                        requestAnimationFrame(() => {
                            oldSlide.style.transform = `translateX(${-100 * direction}%)`;
                            newSlide.style.transform = 'translateX(0%)';
                        });
                    } else if (settings.transition === 'slide-y') {
                        newSlide.style.transform = `translateY(${100 * direction}%)`;
                        requestAnimationFrame(() => {
                            oldSlide.style.transform = `translateY(${-100 * direction}%)`;
                            newSlide.style.transform = 'translateY(0%)';
                        });
                    }
                    currentSlide = newIndex;
                };

                const next = () => showSlide((currentSlide + 1) % totalSlides, 1);
                
                document.getElementById('carousel-next')?.addEventListener('click', next);
                document.getElementById('carousel-prev')?.addEventListener('click', () => showSlide((currentSlide - 1 + totalSlides) % totalSlides, -1));
                dots.forEach(d => d.addEventListener('click', () => showSlide(parseInt(d.dataset.slideTo), parseInt(d.dataset.slideTo) > currentSlide ? 1 : -1)));

                this.state.carouselInterval = setInterval(next, settings.delay);
            },

            handleScroll() { /* ... */ },
            helpers: { /* ... */ },
            router: async () => { /* ... */ },
            
            fetchNavIfNeeded: async () => { /* ... */ },
            fetchDataIfNeeded: async () => { /* ... */ },
            fetchTagsIfNeeded: async () => { /* ... */ },
            fetchFriendlyLinksIfNeeded: async () => { /* ... */ },
            fetchRecentCommentsIfNeeded: async () => { /* ... */ },
            fetchCommentsForPost: async (slug) => { /* ... */ },
            fetchSinglePost: async (slug) => { /* ... */ },
            fetchSiteStatsIfNeeded: async () => { /* ... */ },
            fetchSearchResults: async (q) => { /* ... */ },
            fetchCarouselSettingsIfNeeded: async () => { if (!App.state.carouselSettings) try { const r = await fetch(`${App.config.workerUrl}/api/carousel-settings`); App.state.carouselSettings = await r.json(); } catch (e) {} },
            handleSearchSubmit: (e) => { /* ... */ },
            handleCommentSubmit: async (e, slug) => { /* ... */ },

            templates: {
                header: () => { /* ... */ },
                sidebar: () => `...`,
                footer: () => `...`,
                friendlyLinksSection: () => { /* ... */ },
                mainLayout: (content) => `...`,
                carousel: () => {
                    const settings = App.state.carouselSettings || { slides: [] };
                    if (settings.slides.length === 0) return '';
                    
                    return `<div id="carousel-container" class="relative w-full h-[230px] overflow-hidden rounded-lg shadow-lg">
                        ${settings.slides.map((slide, i)=>`<a href="${slide.linkUrl || '#'}" target="_blank" rel="noopener noreferrer" class="carousel-slide absolute w-full h-full" style="transition-property: opacity, transform; transition-timing-function: ease-in-out; opacity: ${i===0?1:0};"><img src="${slide.imageUrl}" class="w-full h-full object-cover"></a>`).join('')}
                        <button id="carousel-prev" class="absolute top-1/2 left-4 -translate-y-1/2 bg-black/30 text-white rounded-full w-10 h-10 flex items-center justify-center hover:bg-black/50"><i class="fas fa-chevron-left"></i></button>
                        <button id="carousel-next" class="absolute top-1/2 right-4 -translate-y-1/2 bg-black/30 text-white rounded-full w-10 h-10 flex items-center justify-center hover:bg-black/50"><i class="fas fa-chevron-right"></i></button>
                        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2">${settings.slides.map((_,i)=>`<button class="carousel-dot h-3 w-3 rounded-full ${i===0?'bg-white':'bg-white/50'}" data-slide-to="${i}"></button>`).join('')}</div>
                    </div>`;
                },
                homePage: (posts, title = "最新文章") => `...`,
                postCard: (post) => `...`,
                postPage: (post) => `...`,
                commentForm: (slug) => `...`,
                commentsSection: (slug) => `...`,
                loader: () => `<div class="flex justify-center items-center py-20"><div class="loader"></div></div>`,
                notFoundPage: () => `<div class="text-center py-20"><h1 class="text-4xl font-bold">404</h1><p class="mt-4">页面不存在</p><a href="#" class="mt-6 inline-block bg-blue-500 text-white px-6 py-2 rounded">返回首页</a></div>`
            }
        };
        
        App.init();
    </script>
</body>
</html>
