<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的博客</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://gravatar.azure.cc/static/lib/fontawesome5pro/css/all.min.css?v=1.5.8">
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .content-area a { color: #3b82f6; text-decoration: underline; }
        .dark .content-area a { color: #60a5fa; }
        .content-area h1, .content-area h2, .content-area h3 { font-weight: 600; margin-top: 1.5em; margin-bottom: 0.5em; border: none; padding: 0;}
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        #back-to-top { position: fixed; bottom: 2rem; right: 2rem; display: none; }
        
        .rounded-lg { border-radius: 0.3rem !important; }
        .rounded-md { border-radius: 0.1rem !important; }
        .py-8 { padding-top: 1.5rem !important; padding-bottom: 1.8rem !important; }
        .border-gray-200 { border-color: rgb(245 245 245 / 1) !important; }
        .dark .dark\:divide-gray-700 > :not([hidden]) ~ :not([hidden]),
        .dark .dark\:border-gray-700 { border-color: rgb(31 41 55 / 1) !important; }
        body { background-color: #f5f5f5; transition: background-color .3s; }
        .dark body { background-color: #111827; }

        /* 新增：轮播图动效样式 */
        .carousel-slide { transition-property: opacity, transform; }
    </style>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
</head>
<body class="text-gray-800 dark:text-gray-200">

    <div id="app" class="flex flex-col min-h-screen"></div>
    
    <button id="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="bg-blue-500 hover:bg-blue-600 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center">
      <i class="fal fa-arrow-up"></i>
    </button>

    <script>
        const App = {
            config: {
                workerUrl: 'https://blog.xy193.workers.dev' // 请替换为您的 Worker URL
            },
            state: {
                posts: [], navItems: [], tags: [], categories: {}, recentPosts: [],
                friendlyLinks: [], recentComments: [], siteStats: null, comments: {}, 
                theme: localStorage.getItem('theme') || 'light', carouselInterval: null, carouselSettings: null
            },
            init() { /* ... */ },
            applyTheme() { /* ... */ },
            toggleTheme() { /* ... */ },
            
            initCarousel() {
                const container = document.getElementById('carousel-container');
                if (!container) return;
                if (this.state.carouselInterval) clearInterval(this.state.carouselInterval);

                const settings = this.state.carouselSettings || { transition: 'fade', speed: 700, delay: 5000 };
                container.style.setProperty('--carousel-speed', `${settings.speed}ms`);

                let currentSlide = 0;
                const slides = container.querySelectorAll('.carousel-slide');
                const dots = container.querySelectorAll('.carousel-dot');
                const totalSlides = slides.length;
                if (totalSlides <= 1) return;

                const showSlide = (newIndex, direction = 1) => {
                    const oldIndex = currentSlide;
                    if (newIndex === oldIndex) return;
                    
                    const oldSlide = slides[oldIndex];
                    const newSlide = slides[newIndex];

                    dots.forEach((d, i) => d.classList.toggle('bg-white/50', i !== newIndex));

                    if (settings.transition === 'fade') {
                        oldSlide.style.opacity = '0';
                        newSlide.style.opacity = '1';
                    } else if (settings.transition === 'slide-x') {
                        newSlide.style.transform = `translateX(${100 * direction}%)`;
                        requestAnimationFrame(() => {
                            oldSlide.style.transform = `translateX(${-100 * direction}%)`;
                            newSlide.style.transform = 'translateX(0%)';
                        });
                    } else if (settings.transition === 'slide-y') {
                        newSlide.style.transform = `translateY(${100 * direction}%)`;
                        requestAnimationFrame(() => {
                            oldSlide.style.transform = `translateY(${-100 * direction}%)`;
                            newSlide.style.transform = 'translateY(0%)';
                        });
                    }
                    currentSlide = newIndex;
                };

                const next = () => showSlide((currentSlide + 1) % totalSlides, 1);
                const prev = () => showSlide((currentSlide - 1 + totalSlides) % totalSlides, -1);
                
                document.getElementById('carousel-next')?.addEventListener('click', next);
                document.getElementById('carousel-prev')?.addEventListener('click', prev);
                dots.forEach(d => d.addEventListener('click', () => showSlide(parseInt(d.dataset.slideTo), parseInt(d.dataset.slideTo) > currentSlide ? 1 : -1)));

                this.state.carouselInterval = setInterval(next, settings.delay);
            },

            handleScroll() { /* ... */ },
            helpers: { /* ... */ },
            router: async () => {
                const app = document.getElementById('app');
                app.innerHTML = App.templates.loader();
                const path = window.location.hash.slice(1) || '/';
                await Promise.all([ App.fetchNavIfNeeded(), App.fetchTagsIfNeeded(), App.fetchFriendlyLinksIfNeeded(), App.fetchRecentCommentsIfNeeded(), App.fetchSiteStatsIfNeeded(), App.fetchCarouselSettingsIfNeeded() ]);
                await App.fetchDataIfNeeded();
                
                let contentHtml = '';
                // ... router logic ...
                app.innerHTML = App.templates.mainLayout(contentHtml);
                if (path === '/') setTimeout(App.initCarousel, 0);
            },
            
            fetchCarouselSettingsIfNeeded: async () => { if (!App.state.carouselSettings) try { const r = await fetch(`${App.config.workerUrl}/api/carousel-settings`); App.state.carouselSettings = await r.json(); } catch (e) {} },
            // ... other fetch functions ...
            
            templates: {
                header: () => { /* ... */ },
                sidebar: () => `...`,
                footer: () => `...`,
                friendlyLinksSection: () => { /* ... */ },
                mainLayout: (content) => `...`,
                carousel: () => {
                    const images = [ 'https://placehold.co/1200x230/3b82f6/ffffff?text=Banner+1', 'https://placehold.co/1200x230/ef4444/ffffff?text=Banner+2', 'https://placehold.co/1200x230/22c55e/ffffff?text=Banner+3' ];
                    const settings = App.state.carouselSettings || { transition: 'fade' };
                    return `<div id="carousel-container" class="relative w-full h-[230px] overflow-hidden rounded-lg shadow-lg">
                        ${images.map((src, i) => `<div class="carousel-slide absolute w-full h-full" style="transition-duration: var(--carousel-speed, 700ms); opacity: ${i===0?1:0}; transform: ${settings.transition === 'slide-x' && i !== 0 ? 'translateX(100%)' : (settings.transition === 'slide-y' && i !== 0 ? 'translateY(100%)' : 'none')};"><img src="${src}" class="w-full h-full object-cover"></div>`).join('')}
                        <button id="carousel-prev" class="absolute top-1/2 left-4 -translate-y-1/2 bg-black/30 text-white rounded-full w-10 h-10 flex items-center justify-center hover:bg-black/50"><i class="fas fa-chevron-left"></i></button>
                        <button id="carousel-next" class="absolute top-1/2 right-4 -translate-y-1/2 bg-black/30 text-white rounded-full w-10 h-10 flex items-center justify-center hover:bg-black/50"><i class="fas fa-chevron-right"></i></button>
                        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2">${images.map((_,i)=>`<button class="carousel-dot h-3 w-3 rounded-full ${i===0?'bg-white':'bg-white/50'}" data-slide-to="${i}"></button>`).join('')}</div>
                    </div>`;
                },
                homePage: (posts, title = "最新文章") => `...`,
                postCard: (post) => `...`,
                postPage: (post) => `...`,
                commentForm: (slug) => `...`,
                commentsSection: (slug) => `...`,
                loader: () => `<div class="flex justify-center items-center py-20"><div class="loader"></div></div>`,
                notFoundPage: () => `<div class="text-center py-20"><h1 class="text-4xl font-bold">404</h1><p class="mt-4">页面不存在</p><a href="#" class="mt-6 inline-block bg-blue-500 text-white px-6 py-2 rounded">返回首页</a></div>`
            }
        };
        
        App.init();
    </script>
</body>
</html>
