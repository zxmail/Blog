<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的博客</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://gravatar.azure.cc/static/lib/fontawesome5pro/css/all.min.css?v=1.5.8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sticky-sidebar-v2/dist/sticky-sidebar.min.js"></script>
    <script>
        tailwind.config = { darkMode: 'class' };
    </script>
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .content-area { font-size: 15px; line-height: 1.7; color: #606266; }
        .dark .content-area { color: #d1d5db; }
        .content-area a { color: #3b82f6; text-decoration: underline; }
        .dark .content-area a { color: #60a5fa; }
        #back-to-top { position: fixed; bottom: 20%; right: 2rem; display: none; width: 38px; height: 38px; border-radius: 3px; background-color: rgb(188 188 188); color: #1e1e1e; transition: background-color: 0.3s ease, color: 0.3s ease; }
        #back-to-top:hover { background-color: rgb(123 123 123); color: #fff; }
        #back-to-top i { font-size: 15px; font-weight: 400; }
        body { background-color: #f5f5f5; }
        .dark body { background-color: #111827; }
        .divide-gray-200 > :not([hidden]) ~ :not([hidden]), .border-gray-200 { border-color: rgb(245 245 245 / 1) !important; }
        .dark .dark\:divide-gray-700 > :not([hidden]) ~ :not([hidden]), .dark .dark\:border-gray-700 { border-color: rgb(31 41 55 / 1) !important; }
        .rounded-lg { border-radius: 0.2rem !important; }
        .rounded-md { border-radius: 0.1rem !important; }
        .swiper-button-next, .swiper-button-prev { color: #ffffff; background-color: rgba(0,0,0,0.25); width: 44px; height: 44px; border-radius: 50%; opacity: 0; transition: opacity 0.3s ease, background-color: 0.3s ease; }
        .swiper:hover .swiper-button-next, .swiper:hover .swiper-button-prev { opacity: 1; }
        .swiper-button-next:hover, .swiper-button-prev:hover { background-color: rgba(0,0,0,0.4); }
        .swiper-button-next:after, .swiper-button-prev:after { font-size: 20px; font-weight: bold; }
        .swiper-pagination-bullet { background-color: rgba(255, 255, 255, 0.7); }
        .swiper-pagination-bullet-active { background-color: #ffffff; }
        .group .dropdown-menu { display: none; }
        .group:hover > .dropdown-menu { display: block; }
        .dropdown-menu .sub-menu { display: none; }
        .dropdown-menu li:hover > .sub-menu { display: block; }
        .dark .dropdown-menu, .dark .sub-menu { background-color: #1f2937; border-color: #4b5563; }
        .sub-menu { top: -0.25rem; left: 100%; }
        #sidebar-menu .rotate-90 { transform: rotate(90deg); }
        #sidebar-menu { font-size: 13px; }

        @media (max-width: 639.98px) {
            body .p-4 {
                padding: 0.5rem;
            }
            body .p-6 {
                padding: 0.9rem;
            }
        }
    </style>
</head>
<body class="text-gray-800 dark:text-gray-200">

    <div id="app" class="flex flex-col min-h-screen"></div>
    <div id="sidebar-container"></div>
    <div id="search-modal-container"></div>
    
    <button id="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="shadow-lg flex items-center justify-center">
      <i class="far fa-arrow-up"></i>
    </button>

    <script>
        const App = {
            config: {
                workerUrl: 'https://blog.xy193.workers.dev'
            },
            state: {
                posts: [],
                navItems: [],
                tags: [],
                categories: {},
                recentPosts: [],
                friendlyLinks: [],
                recentComments: [],
                siteStats: null,
                siteSettings: null,
                comments: {}, 
                theme: localStorage.getItem('theme') || 'light',
                carouselData: null,
                desktopSidebar: null,
            },
            helpers: {
                stripHtmlAndTruncate: (html, length) => { const doc = new DOMParser().parseFromString(html, 'text/html'); const text = doc.body.textContent || ""; return text.length > length ? text.substring(0, length) + '...' : text; },
                renderIcon: (iconString) => {
                    if (!iconString) return '<i class="fa-fw"></i>';
                    if (iconString.trim().startsWith('<svg')) return iconString;
                    return `<i class="${iconString} fa-fw"></i>`;
                }
            },
            init() {
                this.applyTheme();
                this.renderMobileSidebar();
                this.renderSearchModal();
                window.addEventListener('hashchange', () => this.router());
                window.addEventListener('load', () => this.router());
                window.addEventListener('scroll', () => this.handleScroll());
            },
            applyTheme() { if (this.state.theme === 'dark') document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); },
            toggleTheme() { this.state.theme = this.state.theme === 'light' ? 'dark' : 'light'; localStorage.setItem('theme', this.state.theme); this.applyTheme(); this.renderMobileSidebar(); const btn = document.getElementById('theme-toggle-button'); if(btn) btn.innerHTML = this.state.theme === 'light' ? `<i class="fal fa-moon h-5 w-5"></i>` : `<i class="fal fa-sun h-5 w-5"></i>`; },
            
            // --- Mobile Sidebar & Search Modal Methods ---
            renderMobileSidebar() {
                 document.getElementById('sidebar-container').innerHTML = this.templates.mobileSidebar();
            },
            openSidebar() {
                document.getElementById('sidebar-overlay')?.classList.remove('hidden');
                document.getElementById('sidebar-menu')?.classList.remove('-translate-x-full');
            },
            closeSidebar() {
                document.getElementById('sidebar-overlay')?.classList.add('hidden');
                document.getElementById('sidebar-menu')?.classList.add('-translate-x-full');
            },
            toggleSubMenu(event) {
                const parentLi = event.target.closest('li');
                const subMenu = parentLi?.querySelector('ul');
                const arrow = parentLi?.querySelector('i.fa-chevron-right');
                if (subMenu) {
                    subMenu.classList.toggle('hidden');
                    arrow?.classList.toggle('rotate-90');
                }
            },
            renderSearchModal() {
                document.getElementById('search-modal-container').innerHTML = this.templates.searchModal();
            },
            openSearchModal() {
                const modal = document.getElementById('search-modal');
                if (modal) {
                    modal.classList.remove('hidden');
                    modal.querySelector('input[name="query"]')?.focus();
                }
            },
            closeSearchModal() {
                document.getElementById('search-modal')?.classList.add('hidden');
            },

            initSwiper() { if (document.querySelector('.swiper') && this.state.carouselData && this.state.carouselData.slides && this.state.carouselData.slides.length > 0) { new Swiper('.swiper', { loop: true, autoplay: { delay: 5000, disableOnInteraction: false }, pagination: { el: '.swiper-pagination', clickable: true }, navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }, }); } },
            initStickySidebar() { const sidebarElement = document.querySelector('#desktop-sidebar-wrapper'); if (sidebarElement) { if (this.state.desktopSidebar) { this.state.desktopSidebar.destroy(); } this.state.desktopSidebar = new StickySidebar('#desktop-sidebar-wrapper', { topSpacing: 80, bottomSpacing: 20, containerSelector: '.main-container', innerWrapperSelector: '.sidebar-inner-wrapper' }); } },
            async router() {
                const appContainer = document.getElementById('app');
                const path = window.location.hash.slice(1) || '/';
                const parts = path.split('/');
                await Promise.all([ this.fetchNavIfNeeded(), this.fetchTagsIfNeeded(), this.fetchFriendlyLinksIfNeeded(), this.fetchRecentCommentsIfNeeded(), this.fetchSiteStatsIfNeeded(), this.fetchCarouselDataIfNeeded(), this.fetchSiteSettingsIfNeeded() ]);
                await this.fetchDataIfNeeded();
                
                if (path === '/') {
                    appContainer.innerHTML = this.templates.mainLayout(this.templates.homePage(this.state.posts));
                    this.initSwiper();
                } else if (parts[1] === 'post' && parts[2]) {
                    const slug = parts[2];
                    const post = await this.fetchSinglePost(slug);
                    await this.fetchCommentsForPost(slug);
                    if (post) { const postIndex = this.state.posts.findIndex(p => p.slug === slug); if (postIndex > -1) this.state.posts[postIndex] = post; else this.state.posts.unshift(post); }
                    appContainer.innerHTML = this.templates.mainLayout(this.templates.postPage(post));
                } else if (['search', 'category', 'tag'].includes(parts[1])) {
                    let results = [];
                    let title = "文章列表";
                    if(parts[1] === 'search' && parts[2]) { const query = decodeURIComponent(parts[2]); results = await this.fetchSearchResults(query); title = `搜索结果: "${query}"`;
                    } else if (parts[1] === 'category') { const categoryName = parts.slice(2).map(decodeURIComponent).join('/'); results = this.state.posts.filter(p => p.category && p.category.startsWith(categoryName)); title = `分类: ${categoryName}`;
                    } else if (parts[1] === 'tag' && parts[2]) { const tagName = decodeURIComponent(parts[2]); results = this.state.posts.filter(p => p.tags && p.tags.includes(tagName)); title = `标签: ${tagName}`; }
                    appContainer.innerHTML = this.templates.mainLayout(this.templates.homePage(results, title));
                    this.initSwiper();
                } else {
                    appContainer.innerHTML = this.templates.mainLayout(this.templates.notFoundPage());
                }
                document.title = this.state.siteSettings?.blogName || '我的博客';
                this.initStickySidebar();
                this.renderMobileSidebar();
            },
            handleSearchSubmit(event) {
                event.preventDefault();
                const query = event.target.querySelector('[name="query"]').value.trim();
                if (query) {
                    window.location.hash = `#/search/${encodeURIComponent(query)}`;
                }
                this.closeSearchModal();
            },
            async handleCommentSubmit(event, slug) { event.preventDefault(); const { nickname, content } = event.target; if (!nickname.value.trim() || !content.value.trim()) { alert('昵称和内容不能为空!'); return; } try { const res = await fetch(`${this.config.workerUrl}/api/comments/${slug}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ nickname: nickname.value, content: content.value }) }); if (res.ok) { event.target.reset(); this.state.recentComments = []; this.state.siteStats = null; await this.fetchCommentsForPost(slug); this.router(); } else throw new Error('评论失败'); } catch (e) { alert('评论提交失败'); } },
            async fetchNavIfNeeded() { if (this.state.navItems.length === 0) try { const res = await fetch(`${this.config.workerUrl}/api/nav`); this.state.navItems = await res.json(); } catch (e) { this.state.navItems = [{ label: '首页', url: '#/' }]; } },
            async fetchDataIfNeeded(forceRefresh = false) { if (this.state.posts.length === 0 || forceRefresh) try { const res = await fetch(`${this.config.workerUrl}/api/posts`); const posts = await res.json(); this.state.posts = posts; const categories = {}; posts.forEach(p => { const catParts = p.category.split('/'); catParts.forEach((part, i) => { const catPath = catParts.slice(0, i + 1).join('/'); categories[catPath] = (categories[catPath] || 0) + 1; }); }); this.state.categories = categories; this.state.recentPosts = posts.slice(0, 5); } catch (e) {} },
            async fetchTagsIfNeeded() { if (this.state.tags.length === 0) try { const res = await fetch(`${this.config.workerUrl}/api/tags`); this.state.tags = await res.json(); } catch (e) {} },
            async fetchFriendlyLinksIfNeeded() { if (this.state.friendlyLinks.length === 0) try { const res = await fetch(`${this.config.workerUrl}/api/links`); this.state.friendlyLinks = await res.json(); } catch (e) {} },
            async fetchRecentCommentsIfNeeded(forceRefresh = false) { if (this.state.recentComments.length === 0 || forceRefresh) try { const res = await fetch(`${this.config.workerUrl}/api/comments/recent`); this.state.recentComments = await res.json(); } catch (e) {} },
            async fetchCommentsForPost(slug) { try { const res = await fetch(`${this.config.workerUrl}/api/comments/${slug}`); this.state.comments[slug] = await res.json(); } catch (e) { this.state.comments[slug] = []; } },
            async fetchSinglePost(slug) { try { const response = await fetch(`${this.config.workerUrl}/api/posts/${slug}`); if (!response.ok) throw new Error('Post not found'); return await response.json(); } catch (error) { return null; } },
            async fetchSiteStatsIfNeeded(forceRefresh = false) { if (!this.state.siteStats || forceRefresh) try { const res = await fetch(`${this.config.workerUrl}/api/stats`); this.state.siteStats = await res.json(); } catch (e) {} },
            async fetchSiteSettingsIfNeeded(forceRefresh = false) { if (!this.state.siteSettings || forceRefresh) try { const res = await fetch(`${this.config.workerUrl}/api/settings`); this.state.siteSettings = await res.json(); } catch (e) {} },
            async fetchSearchResults(query) { try { const res = await fetch(`${this.config.workerUrl}/api/search?q=${encodeURIComponent(query)}`); return await res.json(); } catch (e) { return []; } },
            async fetchCarouselDataIfNeeded() { if (!this.state.carouselData) try { const res = await fetch(`${this.config.workerUrl}/api/carousel`); this.state.carouselData = await res.json(); } catch (e) {} },
            handleScroll() { const btn = document.getElementById('back-to-top'); if (window.scrollY > 300) btn.style.display = 'flex'; else btn.style.display = 'none'; },
            
            templates: {
                header: () => {
                    const renderMenuItems = (items) => {
                        return `<ul class="list-none">${items.map(item => {
                            const hasChildren = item.children && item.children.length > 0;
                            return `<li class="relative group"><a href="${item.url}" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 flex justify-between items-center"><span>${App.helpers.renderIcon(item.icon)} ${item.label}</span>${hasChildren ? '<i class="fas fa-chevron-right text-xs"></i>' : ''}</a>${hasChildren ? `<div class="absolute hidden sub-menu bg-white dark:bg-gray-800 shadow-lg rounded-md py-1 z-30 w-full border dark:border-gray-700">${renderMenuItems(item.children)}</div>` : ''}</li>`;
                        }).join('')}</ul>`;
                    };
                    const renderTopLevelMenu = (items) => `<nav class="flex items-center space-x-1 text-sm text-gray-600 dark:text-gray-300">${items.map(item => {
                        const hasChildren = item.children && item.children.length > 0;
                        return `<div class="relative group"><a href="${item.url}" class="px-3 py-2 hover:text-blue-500 dark:hover:text-blue-400 flex items-center gap-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800">${App.helpers.renderIcon(item.icon)}<span>${item.label}</span>${hasChildren ? '<i class="fas fa-chevron-down text-xs opacity-70"></i>' : ''}</a>${hasChildren ? `<div class="absolute hidden dropdown-menu bg-white dark:bg-gray-800 shadow-lg rounded-md py-1 z-20 w-full border dark:border-gray-700">${renderMenuItems(item.children)}</div>` : ''}</div>`;
                    }).join('')}</nav>`;
                    
                    const settings = App.state.siteSettings;
                    const logoOrIcon = settings?.logoUrl ? `<img src="${settings.logoUrl}" alt="${settings.blogName || ''} Logo" class="h-[50px] w-auto">` : '';
                    const blogName = settings?.blogName || '';
                    const themeIcon = App.state.theme === 'light' ? `<i class="fal fa-moon h-5 w-5"></i>` : `<i class="fal fa-sun h-5 w-5"></i>`;

                    return `<header class="sticky top-0 z-30 bg-white dark:bg-gray-800 shadow-[0_0.5px_0.5px_1px_rgba(0,0,0,0.1)]">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6">
                            <div class="flex justify-between items-center h-[62px]">
                                <div class="hidden md:flex flex-1 items-center gap-4">
                                    <a href="#" class="font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2">${logoOrIcon}<span class="text-[1.7rem]">${blogName}</span></a>
                                    ${renderTopLevelMenu(App.state.navItems)}
                                </div>
                                <div class="hidden md:flex items-center gap-[6px] text-gray-600 dark:text-gray-300">
                                    <button onclick="App.openSearchModal()" class="p-[0.16rem] rounded-full hover:bg-gray-100 dark:hover:bg-gray-700"><i class="fal fa-search h-5 w-5"></i></button>
                                    <button id="theme-toggle-button" onclick="App.toggleTheme()" class="p-[0.16rem] rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">${themeIcon}</button>
                                    <a href="admin.html" class="text-sm hover:underline">登录</a>
                                </div>
                                <div class="md:hidden flex flex-1 w-full justify-between items-center">
                                    <div class="flex-1 text-left">
                                        <button onclick="App.openSidebar()" class="p-2 -ml-2"><i class="fas fa-bars text-xl"></i></button>
                                    </div>
                                    <div class="flex-shrink-0">
                                        <a href="#" class="flex items-center gap-2">${logoOrIcon}<span class="text-lg font-bold">${blogName}</span></a>
                                    </div>
                                    <div class="flex-1 text-right">
                                         <button onclick="App.openSearchModal()" class="p-2 -mr-2"><i class="fas fa-search text-xl"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>`;
                },
                mobileSidebar: () => {
                    const navItemsHtml = App.templates.mobileSidebarMenuItems(App.state.navItems);
                    const themeIcon = App.state.theme === 'light' ? `<i class="fal fa-moon fa-fw"></i> <span>切换深色模式</span>` : `<i class="fal fa-sun fa-fw"></i> <span>切换浅色模式</span>`;
                    return `
                        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="App.closeSidebar()"></div>
                        <nav id="sidebar-menu" class="fixed top-0 left-0 h-full w-64 bg-white dark:bg-gray-900 shadow-lg z-50 transform -translate-x-full transition-transform duration-300 ease-in-out flex flex-col">
                            <div class="flex justify-between items-center p-4 border-b dark:border-gray-700">
                                <h2 class="font-bold text-lg">菜单</h2>
                                <button onclick="App.closeSidebar()" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <div class="flex-grow p-2 space-y-1 overflow-y-auto">
                                ${navItemsHtml}
                            </div>
                            <div class="p-2 border-t dark:border-gray-700 space-y-1">
                                <button onclick="App.toggleTheme()" class="w-full flex items-center gap-3 p-3 rounded-md text-left hover:bg-gray-100 dark:hover:bg-gray-700">${themeIcon}</button>
                                <a href="admin.html" class="w-full flex items-center gap-3 p-3 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700"><i class="fal fa-user-circle fa-fw"></i> <span>登录</span></a>
                            </div>
                        </nav>
                    `;
                },
                mobileSidebarMenuItems: (items) => { /* ... */ },
                searchModal: () => { /* ... */ },
                mainLayout: (content) => `<div class="flex-grow">${App.templates.header()}<main class="max-w-7xl mx-auto w-full p-4 sm:px-6"><div class="lg:flex gap-[23px] main-container"><div class="w-full lg:w-3/4">${content}</div><div class="w-full lg:w-1/4 hidden lg:block main-sidebar">${App.templates.desktopSidebar()}</div></div></main>${App.templates.friendlyLinksSection()}</div>${App.templates.footer()}`,
                desktopSidebar: () => { /* ... */ },
                sidebarModules: { /* ... */ },

                footer: () => {
                    const stats = App.state.siteStats || {};
                    const contactsHtml = (stats.custom_contacts || []).map(contact => 
                        `<a href="#" class="flex items-center gap-x-1.5 hover:text-blue-500" title="${contact.content}"><i class="${contact.icon}"></i><span>${contact.content}</span></a>`
                    ).join('');

                    return `<footer class="mt-auto text-sm text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6">
                            <div class="py-8">
                                <div class="flex flex-col items-center md:items-start space-y-[3px]">
                                    <div class="hidden md:flex items-center">
                                        <span class="font-semibold text-gray-900 dark:text-gray-100">联系方式：</span>
                                        <div class="flex items-center ml-2 space-x-[10px]">${contactsHtml}</div>
                                    </div>
                                    <div class="hidden md:flex items-center">
                                        <span class="font-semibold text-gray-900 dark:text-gray-100">网站统计：</span>
                                        <div class="flex items-center ml-2 space-x-[5px]">
                                            <span class="flex items-center gap-x-1.5"><i class="fas fa-file-alt w-4 text-center"></i><span>文章总数: ${stats.posts_total||0}</span></span>
                                            <span class="flex items-center gap-x-1.5"><i class="fas fa-folder w-4 text-center"></i><span>分类总数: ${stats.categories_total||0}</span></span>
                                            <span class="flex items-center gap-x-1.5"><i class="fas fa-comments w-4 text-center"></i><span>评论总数: ${stats.comments_total||0}</span></span>
                                        </div>
                                    </div>
                                    <div class="text-center md:text-left">
                                        <span>Copyright © ${stats.copyright_year || new Date().getFullYear()} ${stats.copyright_name || 'My Blog'}. Powered by Cloudflare Workers & Pages. Theme designed with Tailwind CSS.</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </footer>`;
                },
                friendlyLinksSection: () => { if (!App.state.friendlyLinks || App.state.friendlyLinks.length === 0) return ''; return `<div class="max-w-7xl mx-auto w-full p-4 sm:px-6"><div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 my-8"><h3 class="font-semibold text-lg mb-4">友情链接</h3><div class="text-sm text-gray-600 dark:text-gray-400">${(App.state.friendlyLinks||[]).map(link=>`<a href="${link.url}" target="_blank" rel="noopener noreferrer" class="hover:text-blue-500 mr-4">${link.name}</a>`).join('')}</div></div></div>`; },
                carousel: () => { const data = App.state.carouselData; if (!data || !data.slides || data.slides.length === 0) return ''; const slidesHtml = data.slides.map(slide => { const slideContent = `<img src="${slide.imageUrl}" class="w-full h-full object-cover">`; const linkWrapper = slide.linkUrl && slide.linkUrl !== '#' ? `<a href="${slide.linkUrl}" target="_blank" class="block w-full h-full">${slideContent}</a>` : slideContent; return `<div class="swiper-slide">${linkWrapper}</div>`; }).join(''); return `<div class="swiper w-full rounded-lg shadow-lg aspect-[4/1] md:aspect-auto md:h-[230px]"><div class="swiper-wrapper">${slidesHtml}</div><div class="swiper-pagination"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div></div>`; },
                homePage: (posts, title = "最新文章") => `${App.templates.carousel()}<div class="mt-[18px]"><h1 class="text-lg md:text-[1.3rem] font-bold mb-2">${title}</h1><div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"><div class="divide-y divide-gray-200 dark:divide-gray-700">${posts.length > 0 ? posts.map(post => App.templates.postCard(post)).join('') : '<p class="p-6">没有找到相关文章。</p>'}</div></div></div>`,
                postCard: (post) => `<div class="p-6 flex flex-row items-center">
                    <div class="relative w-1/3 flex-shrink-0 overflow-hidden rounded-md aspect-[16/9]">
                        <a href="#/post/${post.slug}" class="block h-full w-full group">
                            <img src="${post.imageUrl || 'https://placehold.co/400x300/e2e8f0/cbd5e0?text=Image'}" alt="${post.title}" class="w-full h-full object-cover transition-transform duration-300 ease-in-out group-hover:scale-110" onerror="this.onerror=null;this.src='https://placehold.co/400x300/e2e8f0/cbd5e0?text=Image';">
                        </a>
                        <a href="#/category/${encodeURIComponent(post.category)}" class="hidden md:block absolute top-3 left-3 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs font-semibold hover:bg-opacity-70">${post.category}</a>
                    </div>
                    <div class="pl-5 flex-grow flex flex-col justify-between self-stretch">
                        <div>
                            <h2 class="text-base md:text-lg font-bold mb-2"><a href="#/post/${post.slug}" class="hover:text-blue-600 dark:hover:text-blue-400">${post.isPinned ? '<span class="text-red-500 font-bold">[置顶]</span> ' : ''}${post.title}</a></h2>
                            <div class="hidden md:block text-gray-600 dark:text-gray-400 leading-relaxed text-sm mb-4">${App.helpers.stripHtmlAndTruncate(post.content, 100)}</div>
                        </div>
                        <div class="flex justify-between items-center text-xs text-gray-500 dark:text-gray-400 mt-auto">
                            <span>${new Date(post.date).toLocaleDateString()}</span>
                            <div class="flex items-center gap-1"><i class="fas fa-eye"></i><span>${post.views || 0}</span></div>
                        </div>
                    </div>
                </div>`,
                postPage: (post) => { /* ... post page template ... */ },
                commentForm: (slug) => { /* ... comment form template ... */ },
                commentsSection: (slug) => { /* ... comments section template ... */ },
                notFoundPage: () => { /* ... not found page template ... */ }
            }
        };
        
        App.init();
    </script>
</body>
</html>
