<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的博客</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .ql-editor { min-height: 250px; font-size: 16px; line-height: 1.7; }
        .content-area { font-size: 16px; line-height: 1.7; }
        .content-area a { color: #3b82f6; text-decoration: underline; }
        .content-area h1, .content-area h2, .content-area h3 { font-weight: 600; margin-top: 1.5em; margin-bottom: 0.5em; border: none; padding: 0;}
        .content-area h1 { font-size: 2em; } .content-area h2 { font-size: 1.5em; } .content-area h3 { font-size: 1.25em; }
        .content-area p { margin-bottom: 1em; } .content-area ul, .content-area ol { padding-left: 2em; margin-bottom: 1em; }
        .content-area blockquote { border-left: 4px solid #e5e7eb; padding-left: 1em; margin-left: 0; color: #6b7280; }
        .content-area pre { background-color: #f3f4f6; padding: 1em; border-radius: 0.5rem; overflow-x: auto; color: #1f2937; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #back-to-top { position: fixed; bottom: 2rem; right: 2rem; display: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8"></div>
    <button id="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="bg-blue-500 hover:bg-blue-600 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" /></svg>
    </button>

    <script>
        const App = {
            config: {
                workerUrl: 'https://blog.xy193.workers.dev' // 请替换为您的 Worker URL
            },
            state: {
                posts: [],
                navItems: [],
                tags: [],
                categories: {},
                recentPosts: [],
                authToken: localStorage.getItem('authToken'),
                editorInstance: null
            },

            init() {
                window.addEventListener('hashchange', this.router);
                window.addEventListener('load', this.router);
                window.addEventListener('scroll', this.handleScroll);
            },
            
            handleScroll() {
                const backToTopButton = document.getElementById('back-to-top');
                if (window.scrollY > 300) {
                    backToTopButton.style.display = 'flex';
                } else {
                    backToTopButton.style.display = 'none';
                }
            },

            helpers: { /* ... no changes ... */ },

            router: async () => {
                const appContainer = document.getElementById('app');
                appContainer.innerHTML = App.templates.loader();

                const path = window.location.hash.slice(1) || '/';
                const parts = path.split('/');

                // Fetch common data, but don't block rendering for posts
                await Promise.all([
                    App.fetchNavIfNeeded(),
                    App.fetchTagsIfNeeded()
                ]);

                // Always fetch posts for main pages to get latest view counts
                if (path === '/' || parts[1] === 'category' || parts[1] === 'tag') {
                   await App.fetchDataIfNeeded(true); // Force refresh
                } else {
                   await App.fetchDataIfNeeded(); // Use cache if available
                }


                if (path === '/') {
                    appContainer.innerHTML = App.templates.mainLayout(App.templates.homePage(App.state.posts));
                } else if (parts[1] === 'post' && parts[2]) {
                    const slug = parts[2];
                    const post = await App.fetchSinglePost(slug); // Fetch single post to increment views
                    
                    if (post) {
                        const postIndex = App.state.posts.findIndex(p => p.slug === slug);
                        if (postIndex > -1) App.state.posts[postIndex] = post;
                        else App.state.posts.unshift(post);
                    }

                    appContainer.innerHTML = App.templates.mainLayout(App.templates.postPage(post));
                } else if (parts[1] === 'category' && parts[2]) {
                    const categoryName = decodeURIComponent(parts[2]);
                    const filteredPosts = App.state.posts.filter(p => p.category === categoryName);
                    appContainer.innerHTML = App.templates.mainLayout(App.templates.homePage(filteredPosts, `分类: ${categoryName}`));
                } else if (parts[1] === 'tag' && parts[2]) {
                    const tagName = decodeURIComponent(parts[2]);
                    const filteredPosts = App.state.posts.filter(p => p.tags && p.tags.includes(tagName));
                    appContainer.innerHTML = App.templates.mainLayout(App.templates.homePage(filteredPosts, `标签: ${tagName}`));
                }
                else if (path === '/admin') {
                    if (App.state.authToken) window.location.hash = '/admin/dashboard';
                    else appContainer.innerHTML = App.templates.loginPage();
                } else if (path === '/admin/dashboard') {
                    if (!App.state.authToken) { window.location.hash = '/admin'; return; }
                    appContainer.innerHTML = App.templates.adminDashboard();
                } else {
                    appContainer.innerHTML = App.templates.mainLayout(App.templates.notFoundPage());
                }
            },
            
            fetchNavIfNeeded: async () => { /* ... no changes ... */ },
            fetchDataIfNeeded: async (forceRefresh = false) => {
                if (App.state.posts.length === 0 || forceRefresh) {
                     try {
                        const response = await fetch(`${App.config.workerUrl}/api/posts`);
                        if (!response.ok) throw new Error('Failed to fetch posts');
                        const posts = await response.json();
                        App.state.posts = posts;
                        const categories = {};
                        posts.forEach(post => {
                            categories[post.category] = (categories[post.category] || 0) + 1;
                        });
                        App.state.categories = categories;
                        // Update recent posts based on the newly sorted list
                        App.state.recentPosts = posts.slice(0, 5);
                    } catch (error) {
                        console.error("Fetch posts error:", error);
                    }
                }
            },
            fetchTagsIfNeeded: async () => { /* ... no changes ... */ },
            
            fetchSinglePost: async (slug) => {
                try {
                    const response = await fetch(`${App.config.workerUrl}/api/posts/${slug}`);
                    if (!response.ok) throw new Error('Post not found');
                    return await response.json();
                } catch (error) {
                    console.error("Fetch single post error:", error);
                    return null;
                }
            },

            handleLogin: async (event) => { /* ... no changes ... */ },
            handleLogout: () => { /* ... no changes ... */ },
            showView: (viewName, param = null) => { /* ... no changes ... */ },
            initEditor: (post = {}) => { /* ... no changes ... */ },

            handlePostFormSubmit: async (event) => {
                 event.preventDefault();
                const form = event.target;
                const slug = form.dataset.slug;
                const isEditing = !!slug;
                const method = isEditing ? 'PUT' : 'POST';
                const url = isEditing ? `${App.config.workerUrl}/api/admin/posts/${slug}` : `${App.config.workerUrl}/api/admin/posts`;
                
                const tagsString = form.tags.value || '';
                const tags = tagsString.split(',').map(tag => tag.trim()).filter(Boolean);

                const postData = {
                    title: form.title.value,
                    category: form.category.value,
                    imageUrl: form.imageUrl.value,
                    content: App.state.editorInstance.root.innerHTML,
                    tags: tags,
                    views: form.views.value,
                    isPinned: form.isPinned.checked, // Capture isPinned state
                    date: isEditing ? form.dataset.date : null
                };

                try {
                    const response = await fetch(url, {
                        method,
                        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${App.state.authToken}` },
                        body: JSON.stringify(postData)
                    });
                    if (response.ok) {
                        alert('文章保存成功!');
                        App.state.posts = [];
                        App.state.tags = [];
                        window.location.hash = '/admin/dashboard';
                    } else { throw new Error('保存失败'); }
                } catch (error) {
                        console.error('Error saving post:', error);
                    alert('文章保存失败。');
                }
            },
            deletePost: async (slug) => { /* ... no changes ... */ },
            
            addNavItemRow: () => { /* ... no changes ... */ },
            removeNavItemRow: (button) => { /* ... no changes ... */ },
            handleNavFormSubmit: async (event) => { /* ... no changes ... */ },
            
            templates: {
                header: () => `
                    <header class="flex justify-between items-center py-4 border-b border-gray-200 mb-8">
                        <a href="#" class="text-2xl font-bold text-gray-900">夏商记</a>
                        <nav class="hidden sm:flex items-center space-x-6 text-gray-600">
                            ${App.state.navItems.map(item => `<a href="${item.url}" class="hover:text-blue-500">${item.label}</a>`).join('')}
                            <a href="#/admin" class="hover:text-blue-500">管理后台</a>
                        </nav>
                    </header>
                `,
                sidebar: () => `
                    <aside class="w-full lg:w-1/4 space-y-8">
                        <div>
                            <h3 class="font-semibold text-lg border-b pb-2 mb-4">近期文章</h3>
                            <ul class="space-y-4">
                                ${App.state.recentPosts.map(post => `
                                    <li>
                                        <a href="#/post/${post.slug}" class="flex items-center gap-3 group">
                                            <img src="${post.imageUrl || 'https://placehold.co/100x75/e2e8f0/cbd5e0?text=Img'}" alt="${post.title}" class="w-20 h-14 object-cover rounded-md flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/100x75/e2e8f0/cbd5e0?text=Img';">
                                            <div>
                                                 <p class="text-sm font-medium text-gray-800 group-hover:text-blue-600 leading-snug">
                                                    ${post.isPinned ? '<span class="text-red-500 font-bold">[置顶]</span> ' : ''}
                                                    ${post.title}
                                                 </p>
                                                 <p class="text-xs text-gray-400 mt-1">${new Date(post.date).toLocaleDateString()}</p>
                                            </div>
                                        </a>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg border-b pb-2 mb-4">分类目录</h3>
                             <ul class="space-y-3">${Object.entries(App.state.categories).map(([category, count]) => `<li><a href="#/category/${encodeURIComponent(category)}" class="text-gray-700 hover:text-blue-600 text-sm flex justify-between"><span>${category}</span><span>(${count})</span></a></li>`).join('')}</ul>
                        </div>
                         <div>
                            <h3 class="font-semibold text-lg border-b pb-2 mb-4">标签</h3>
                            <div class="flex flex-wrap gap-2">
                                ${App.state.tags.map(tag => `<a href="#/tag/${encodeURIComponent(tag)}" class="bg-white text-gray-600 text-sm px-3 py-1 rounded-md border hover:bg-gray-100 hover:border-gray-400">${tag}</a>`).join('')}
                            </div>
                        </div>
                    </aside>
                `,
                mainLayout: (content) => `${App.templates.header()}<main class="flex flex-col lg:flex-row gap-8 lg:gap-12"><div class="w-full lg:w-3/4">${content}</div>${App.templates.sidebar()}</main>`,
                homePage: (posts, title = "所有文章") => `
                    <h1 class="text-2xl font-bold mb-6">${title}</h1>
                    <div class="space-y-8">
                        ${posts.length > 0 ? posts.map(post => App.templates.postCard(post)).join('') : '<p>这里还没有文章。</p>'}
                    </div>
                `,
                postCard: (post) => `
                    <article class="bg-white rounded-lg shadow-sm border border-gray-200 flex flex-col sm:flex-row overflow-hidden items-center">
                         <div class="relative w-full sm:w-2/5 lg:w-1/3 flex-shrink-0">
                            <a href="#/post/${post.slug}" class="block">
                                <img src="${post.imageUrl || 'https://placehold.co/400x300/e2e8f0/cbd5e0?text=Image'}" alt="${post.title}" class="w-full h-48 sm:h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x300/e2e8f0/cbd5e0?text=Image';">
                            </a>
                            <a href="#/category/${encodeURIComponent(post.category)}" class="absolute top-3 left-3 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs font-semibold hover:bg-opacity-70">${post.category}</a>
                        </div>
                        <div class="p-5 flex-grow flex flex-col justify-between self-stretch">
                            <div>
                                <h2 class="text-xl font-bold mb-2">
                                    <a href="#/post/${post.slug}" class="text-gray-900 hover:text-blue-600">
                                        ${post.isPinned ? '<span class="text-red-500 font-bold">[置顶]</span> ' : ''}
                                        ${post.title}
                                    </a>
                                </h2>
                                <div class="text-gray-600 leading-relaxed text-sm mb-4">${App.helpers.stripHtmlAndTruncate(post.content, 100)}</div>
                            </div>
                            <div class="flex justify-between items-center text-xs text-gray-500 mt-2">
                                <span>${new Date(post.date).toLocaleDateString()}</span>
                                <div class="flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                                    <span>${post.views || 0}</span>
                                </div>
                            </div>
                        </div>
                    </article>
                `,
                postPage: (post) => { /* ... no changes ... */ },
                loginPage: () => `...`,
                adminDashboard: () => `...`,
                postManager: () => `...`,
                postEditor: (post = {}) => `
                    <div class="flex justify-between items-center mb-6"><h2 class="text-xl font-semibold">${post.slug ? '编辑文章' : '撰写新文章'}</h2><button onclick="App.showView('posts')" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">返回列表</button></div>
                    <form onsubmit="App.handlePostFormSubmit(event)" data-slug="${post.slug || ''}" data-date="${post.date || ''}" class="bg-white p-6 rounded-lg shadow space-y-6">
                        <div><label for="title" class="block text-sm font-medium text-gray-700">标题</label><input type="text" id="title" name="title" value="${post.title || ''}" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div><label for="category" class="block text-sm font-medium text-gray-700">分类</label><input type="text" id="category" name="category" value="${post.category || ''}" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></div>
                            <div><label for="imageUrl" class="block text-sm font-medium text-gray-700">配图 URL</label><input type="url" id="imageUrl" name="imageUrl" value="${post.imageUrl || ''}" placeholder="https://example.com/image.jpg" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                           <div>
                               <label for="tags" class="block text-sm font-medium text-gray-700">标签 (用英文逗号,隔开)</label>
                               <input type="text" id="tags" name="tags" value="${(post.tags || []).join(', ')}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                           </div>
                           <div class="flex items-center gap-4">
                               <div>
                                   <label for="views" class="block text-sm font-medium text-gray-700">浏览量</label>
                                   <input type="number" id="views" name="views" value="${post.views || 0}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                               </div>
                               <div class="mt-6 flex items-center">
                                    <input type="checkbox" id="isPinned" name="isPinned" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" ${post.isPinned ? 'checked' : ''}>
                                    <label for="isPinned" class="ml-2 text-sm font-medium text-gray-700">置顶</label>
                               </div>
                           </div>
                        </div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">内容</label><div id="editor" class="bg-white"></div></div>
                        <div class="text-right"><button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">保存文章</button></div>
                    </form>
                `,
                navEditor: () => `...`,
                loader: () => `...`,
                notFoundPage: () => `...`
            }
        };

        // --- 模板函数折叠区 (为简洁，此处省略未修改的模板函数完整代码) ---
        App.helpers.stripHtmlAndTruncate = (html, length) => { const doc = new DOMParser().parseFromString(html, 'text/html'); const text = doc.body.textContent || ""; return text.length > length ? text.substring(0, length) + '...' : text; };
        App.fetchNavIfNeeded = async () => { if (App.state.navItems.length === 0) { try { const res = await fetch(`${App.config.workerUrl}/api/nav`); App.state.navItems = await res.json(); } catch (e) { App.state.navItems = [{ label: '首页', url: '#/' }]; } } };
        // App.fetchDataIfNeeded function is complete above
        App.fetchTagsIfNeeded = async () => { if (App.state.tags.length === 0) { try { const res = await fetch(`${App.config.workerUrl}/api/tags`); App.state.tags = await res.json(); } catch (e) { console.error(e); } } };
        App.handleLogin = async (e) => { e.preventDefault(); const { username, password } = e.target; try { const res = await fetch(`${App.config.workerUrl}/api/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: username.value, password: password.value }) }); const data = await res.json(); if (data.success) { App.state.authToken = data.token; localStorage.setItem('authToken', data.token); window.location.hash = '/admin/dashboard'; } else { alert('登录失败'); } } catch (err) { alert('登录出错'); } };
        App.handleLogout = () => { App.state.authToken = null; localStorage.removeItem('authToken'); window.location.hash = '/admin'; };
        App.showView = (viewName, param = null) => { const el = document.getElementById('admin-content'); if (viewName === 'posts') el.innerHTML = App.templates.postManager(); else if (viewName === 'editor') { const post = param ? App.state.posts.find(p => p.slug === param) : {}; el.innerHTML = App.templates.postEditor(post); App.initEditor(post); } else if (viewName === 'nav') el.innerHTML = App.templates.navEditor(); };
        App.initEditor = (post = {}) => { App.state.editorInstance = new Quill('#editor', { theme: 'snow', modules: { toolbar: [[{ 'header': [1, 2, 3, false] }], ['bold', 'italic', 'underline'], ['link', 'image', 'code-block']] } }); if (post.content) App.state.editorInstance.root.innerHTML = post.content; };
        App.deletePost = async (slug) => { if (!confirm('确认删除?')) return; try { const res = await fetch(`${App.config.workerUrl}/api/admin/posts/${slug}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${App.state.authToken}` } }); if (res.ok) { alert('删除成功'); App.state.posts = []; App.router(); } else throw new Error('删除失败'); } catch (e) { alert('删除失败'); } };
        App.addNavItemRow = () => { const container = document.getElementById('nav-item-list'); const div = document.createElement('div'); div.className = 'nav-item-row flex items-center gap-2 mb-2'; div.innerHTML = `<input type="text" name="label" placeholder="菜单项名称" class="flex-1 px-3 py-2 border rounded"><input type="text" name="url" placeholder="URL" class="flex-1 px-3 py-2 border rounded"><button type="button" onclick="App.removeNavItemRow(this)" class="bg-red-500 text-white px-3 py-2 rounded">-</button>`; container.appendChild(div); };
        App.removeNavItemRow = (button) => { button.closest('.nav-item-row').remove(); };
        App.handleNavFormSubmit = async (e) => { e.preventDefault(); const rows = document.querySelectorAll('.nav-item-row'); const newNavItems = Array.from(rows).map(r => ({ label: r.querySelector('[name=label]').value, url: r.querySelector('[name=url]').value })).filter(i => i.label && i.url); try { const res = await fetch(`${App.config.workerUrl}/api/admin/nav`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${App.state.authToken}` }, body: JSON.stringify(newNavItems) }); if (res.ok) { alert('导航更新成功'); App.state.navItems = []; window.location.hash = '/admin/dashboard'; } else throw new Error('更新失败'); } catch (e) { alert('更新失败'); } };
        App.templates.postPage = (post) => { if (!post) return App.templates.notFoundPage(); return ` <article class="bg-white p-6 sm:p-8 rounded-lg shadow-sm border border-gray-200"> <div class="flex items-center text-sm text-gray-500 mb-4"> <a href="#/category/${encodeURIComponent(post.category)}" class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full text-xs font-semibold">${post.category}</a> <span class="mx-2">&middot;</span> <span>发布于 ${new Date(post.date).toLocaleDateString()}</span> <span class="mx-2">&middot;</span> <div class="flex items-center gap-1"> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg> <span>${post.views || 0}</span> </div> </div> <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-6">${post.title}</h1> ${post.imageUrl ? `<img src="${post.imageUrl}" alt="${post.title}" class="w-full rounded-lg mb-8">` : ''} <div class="content-area text-gray-700"> ${post.content} </div> <div class="mt-8 pt-4 border-t flex flex-wrap gap-2"> ${ (post.tags && post.tags.length > 0) ? '<span class="font-semibold">标签:</span>' : '' } ${ (post.tags || []).map(tag => `<a href="#/tag/${encodeURIComponent(tag)}" class="bg-gray-100 text-gray-700 text-sm px-3 py-1 rounded-md hover:bg-gray-200">${tag}</a>`).join('')} </div> </article> `; };
        App.templates.loginPage = () => `<div class="min-h-screen flex items-center justify-center"><div class="max-w-md w-full bg-white p-8 rounded-lg shadow-md"><h2 class="text-2xl font-bold text-center mb-6">管理员登录</h2><form onsubmit="App.handleLogin(event)"><div class="mb-4"><label for="username">用户名</label><input type="text" id="username" name="username" required class="mt-1 block w-full px-3 py-2 border rounded"></div><div class="mb-6"><label for="password">密码</label><input type="password" id="password" name="password" required class="mt-1 block w-full px-3 py-2 border rounded"></div><button type="submit" class="w-full py-2 px-4 bg-blue-600 text-white rounded">登录</button></form></div></div>`;
        App.templates.adminDashboard = () => `<header class="flex justify-between items-center py-4 border-b mb-8"><h1 class="text-2xl font-bold">管理后台</h1><div><a href="#" class="text-blue-500 hover:underline mr-4">返回博客</a><button onclick="App.handleLogout()" class="bg-red-500 text-white py-2 px-4 rounded">退出</button></div></header><div class="flex gap-6"><aside class="w-1/5"><ul class="space-y-2"><li><button onclick="App.showView('posts')" class="w-full text-left font-semibold p-2 rounded hover:bg-gray-200">文章管理</button></li><li><button onclick="App.showView('nav')" class="w-full text-left font-semibold p-2 rounded hover:bg-gray-200">导航设置</button></li></ul></aside><main id="admin-content" class="w-4/5">${App.templates.postManager()}</main></div>`;
        App.templates.postManager = () => `<div class="flex justify-between items-center mb-6"><h2 class="text-xl font-semibold">文章列表</h2><button onclick="App.showView('editor')" class="bg-blue-500 text-white py-2 px-4 rounded">撰写新文章</button></div><div class="bg-white shadow rounded-lg overflow-x-auto"><table class="min-w-full divide-y"><thead><tr><th class="px-6 py-3 text-left">标题</th><th class="px-6 py-3 text-left">分类</th><th class="px-6 py-3 text-left">日期</th><th class="px-6 py-3 text-right">操作</th></tr></thead><tbody>${App.state.posts.map(p => `<tr><td class="px-6 py-4">${p.title}</td><td class="px-6 py-4">${p.category}</td><td class="px-6 py-4">${new Date(p.date).toLocaleDateString()}</td><td class="px-6 py-4 text-right"><button onclick="App.showView('editor', '${p.slug}')" class="text-indigo-600">编辑</button><button onclick="App.deletePost('${p.slug}')" class="text-red-600 ml-2">删除</button></td></tr>`).join('')}</tbody></table></div>`;
        App.templates.navEditor = () => `<h2 class="text-xl font-semibold mb-6">导航菜单设置</h2><form onsubmit="App.handleNavFormSubmit(event)" class="bg-white p-6 rounded-lg shadow"><div id="nav-item-list" class="space-y-2 mb-4">${App.state.navItems.map(item => `<div class="nav-item-row flex items-center gap-2"><input type="text" name="label" value="${item.label}" class="flex-1 px-3 py-2 border rounded"><input type="text" name="url" value="${item.url}" class="flex-1 px-3 py-2 border rounded"><button type="button" onclick="App.removeNavItemRow(this)" class="bg-red-500 text-white px-3 py-2 rounded">-</button></div>`).join('')}</div><button type="button" onclick="App.addNavItemRow()" class="text-sm bg-gray-200 py-2 px-4 rounded mb-4">+ 添加</button><div class="text-right border-t pt-4"><button type="submit" class="bg-green-500 text-white py-2 px-4 rounded">保存</button></div></form>`;
        App.templates.loader = () => `<div class="flex justify-center items-center py-20"><div class="loader"></div></div>`;
        App.templates.notFoundPage = () => `<div class="text-center py-20"><h1 class="text-4xl font-bold">404</h1><p class="mt-4">页面不存在</p><a href="#" class="mt-6 inline-block bg-blue-500 text-white px-6 py-2 rounded">返回首页</a></div>`;
        
        App.init();
    </script>
</body>
</html>

